#!/usr/bin/env bash
set -euo pipefail

# Default parameters
POKE_CMD="pokeget random --hide-name"
FASTFETCH_CMD="fastfetch --file-raw /dev/stdin --logo-padding-left 4"

# Parse arguments
while [[ $# -gt 0 ]]; do
    case "$1" in
        --poke)
            POKE_CMD="$2"
            shift 2
            ;;
        --help|-h)
            echo "Usage: poke-fetch [--poke \"cmd\"]"
            echo "  --poke   override pokemon-colorscripts command"
            exit 0
            ;;
        *)
            echo "Unknown option: $1" >&2
            exit 1
            ;;
    esac
done

# Check dependencies
command -v fastfetch >/dev/null 2>&1 || {
    echo "âš  fastfetch is not installed" >&2
    exit 1
}


if ! pokemon_output=$(eval "$POKE_CMD" 2>/dev/null) || [[ -z "$pokemon_output" ]]; then
    exec fastfetch -c /usr/share/fastfetch/presets/examples/20.jsonc
fi

# Compute heights
fastfetch_height=$(fastfetch --logo none | wc -l)
pokemon_height=$(echo "$pokemon_output" | wc -l)

# Center pokemon vertically when smaller than fetch
if (( fastfetch_height > pokemon_height )); then
    padding=$(( (fastfetch_height - pokemon_height) / 2 ))
    {
        for ((i=0; i<padding; i++)); do echo; done
        echo "$pokemon_output"
    } | $FASTFETCH_CMD
else
    echo "$pokemon_output" | $FASTFETCH_CMD
fi
